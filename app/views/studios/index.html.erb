<%# DANGER, WILL ROBINSON - this table's columns are referenced in the javascript - so consider your changes carefully.  %>
<%= javascript_include_tag 'data_tables/studios' %>

<div class="row span12">

  <h2>
    <%= t(:studios_index_title) %>
  </h2>

  <div class="row">
    <div class="span3 dataTables_filter">
      <%= form_tag new_studio_path, method: :get do %>
          <button type="submit" class="btn btn-success">
            <i class="icon-plus icon-white"></i>
            <%= t(:studios_new_link) %>...
          </button>
      <% end %>
    </div>
  </div>

  <table class="table table-bordered table-striped" id='studios_table'>
    <thead>
    <tr>
      <th>Actions</th>
      <th>Logo?</th>
      <th title='date studio clicked through EAP email'>EAP</th>
      <th title='date studio clicked through TKG email'>TKG</th>
      <th title='date studio clicked through XMS email'>XMS</th>
      <th title='send studio an email'>Name</th>
      <th title='send owner an email'>Owner</th>
      <th>Website</th>
      <th>Phone number</th>
      <th>Location</th>
      <th>Sales<br/>status</th>
      <th>Created</th>
      <th>created for DataTable</th>
    </tr>
    </thead>
    <tbody>
    <% @studios.all.each do |studio| %>
        <tr>
          <td>
            <% if elink = eap_link(studio) %>
                <%= elink %>
                <br>
            <% end %>
            <% if tlink = tkg_link(studio) %>
                <%= tlink %>
                <br>
            <% end %>
            <% if xlink = xms_link(studio) %>
                <%= xlink %>
                <br>
            <% end %>
            <%= link_to('Impersonate', "/switch_user?scope_identifier=user_#{studio.owner.id}") if studio.owner %>
            <br>
            <%= link_to 'Branding', show_branding_studio_path(studio) %>
            <br>
            <%= link_to t(:edit), edit_studio_path(studio) %>
            <br>
            <%= link_to t(:destroy), studio, confirm: t(:link_destroy_confirm), method: :delete %>
            <br>
          </td>
          <td><%= studio.try(:logoize) ? 'logo' : 'nologo' %></td>
          <td title='<%= time_short_index studio.eap_click %>'><%= date_short studio.eap_click %></td>
          <td title='<%= time_short_index studio.tkg_click %>'><%= date_short studio.tkg_click %></td>
          <td title='<%= time_short_index studio.xms_click %>'><%= date_short studio.xms_click %></td>
          <td><%= studio_email_link(studio) %></td>
          <td><%= user_email_link(studio.owner) %></td>
          <td><%= link_from_site_short_name(studio.info.try(:website)) %></td>
          <td><%= number_to_phone studio.phone_number, area_code: true %></td>
          <td><%= studio.try(:city_state_name) %></td>
          <td><%= editable_field studio, :sales_status, {tooltip: studio.sales_notes} %></td>
          <td><%= date_short studio.created_at %></td>
          <td><%= studio.created_at.to_s(:javascript) %></td>
        </tr>
    <% end %>
    </tbody>
  </table>

</div>