<div id='shopping_item_index' class="row">
  <table class='table table-bordered rounded'>
    <thead>
    <th class='left'>Piece</th>
    <th class=''>&nbsp;</th>
    <th class=''>Price</th>
    <th class=''>Quantity</th>
    <th class=''>Total</th>
    </thead>
    <tbody>
    <% total = 0 %>
    <% cart.items.each do |item| %>
        <% if item.offer %>
            <tr>
              <td class='left'>
                <%= item.try(:offer).try(:name) %>
                <% if item.try(:option) %>
                    <br>
                    <%= "#{item.option} #{item.option_selected}" %>
                <% end %>
              </td>
              <td class=''>
                <%= link_to image_tag(item.offer.image_url.to_s,
                                      :title  => item.offer.name,
                                      :alt    => item.offer.name,
                                      :width  => 150,
                                      :class  => "img-rounded",
                                      :border => 0),
                            minisite_offer_url(item.offer),
                            {:style => "text-decoration: none;"} %>
              </td>
              <td class='right'>
                <%= number_to_currency item.price.to_f %>
              </td>
              <td class=" <%= show_status_only ? 'right' : 'left' %>">
                <% if show_status_only %>
                    <%= item.quantity %>
                <% else %>
                    <% option, options = options_for_shopping_item(item) %>
                    <% if option %>
                        <%= select_tag(option, options) %>
                        <%= label_tag(option) %>
                        <br>
                    <% end %>
                    <%= text_field_tag :quantity, item.quantity, size: 3, class: 'input-small' %>
                    <%= link_to 'update', shopping_item_path(item),
                                class: :update_quantity %>
                <% end %>
              </td>
              <td class='right'>
                <%= number_to_currency item.extension %>
              </td>
            </tr>
        <% else %>
            <% Rails.logger.info("ORPHAN OFFER::Shopping Cart item=>#{item.inspect}") %>
        <% end %>
    <% end %>
    <tr>
      <td colspan=5>&nbsp;</td>
    </tr>
    <tr>
      <td class='left'>Shipping</td>
      <td class=''><%= cart.shipping ? cart.shipping.shipping_option : 'no shipping selected yet' %> </td>
      <td class=''>&nbsp;</td>
      <td class=''>&nbsp;</td>
      <td class='right'><%= cart.shipping ? number_to_currency(cart.shipping.total_cents / 100.0) : 'n/a' %></td>
    </tr>
    <tr>
      <td class='left'>Tax</td>
      <td class=''><%= cart.purchase ? cart.purchase.tax_short_description : 'tax calculated at checkout' %> </td>
      <td class=''>&nbsp;</td>
      <td class=''>&nbsp;</td>
      <td class='right'><%= cart.purchase ? number_to_currency(cart.purchase.tax) : 'n/a' %></td>
    </tr>
    <tr>
      <td class='left total'>Total</td>
      <td class='total'>&nbsp;</td>
      <td class='total'>&nbsp;</td>
      <td class='right total'><%= cart.quantity %></td>
      <td class='right total'><%= number_to_currency(cart.total) %></td>
    </tr>
    </tbody>
  </table>
</div>