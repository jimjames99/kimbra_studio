<%= form_for(@item_side, :url => minisite_item_side_path(@item_side), html: {multipart: true}) do |f| %>

    <% if @item_side.errors.any? %>
        <div id="error_explanation">
          <h2><%= pluralize(@item_side.errors.count, "error") %> prohibited this admin_customer_item_side
            from being saved:</h2>
          <ul>
            <% @item_side.errors.full_messages.each do |msg| %>
                <li><%= msg %></li>
            <% end %>
          </ul>
        </div>
    <% end %>

    <div id='hidden_fields'>
      <%= f.fields_for :portrait, @item_side.portrait do |p| %>
          <%= p.hidden_field :id, :value => @item_side.portrait.id %>
      <% end %>
    </div>

    <div class='preview'>

      <h1>Preview Custom Image</h1>
      <p>Jim, you should probably add some helpful text about how to do their edit process</p>
      <p>in File=>minisite/item_sides/_form.html.erb</p>
      <table>
        <tr>
          <td>
            <div id="portrait_item">
              <!-- Constrain stock image to be 300px wide. Height varies according to part. This is done in the css. -->
              <%= image_tag @item_side.image_stock_url(:croppable), :id => 'cropbox' %>
            </div>

          </td>
          <td align="top">

            <% v = @item_side.part.piece_layout.layout.size.inspect %>
            <%= f.hidden_field @item_side.part.piece_layout.layout.size, :value => v %>
            <!-- Constrain preview images to be 300px wide in this div. Height varies according to part. Can't do this bit in the css. -->
            <div id='part_item_preview' style='width:300px; height:<%= 300.0 / @item_side.part.width * @item_side.part.height %>px;'>
              <%= image_tag @item_side.part.image_part_url, :id => 'part_template' %>
              <%= image_tag @item_side.image_stock_url(:croppable), :id => 'preview' %>
            </div>

            <% %w[x y w h].each do |attr| %>
                <%= f.hidden_field "crop_#{attr}" %>
            <% end %>

          </td>
        </tr>
      </table>
    </div>

    <div id="portrait_form">

    </div>

    <!-- Studio Portraits and current charm portrait -->
    <div class="portraits">
      <h1>My Photos</h1>
      <table class='portrait-pick'>
        <tr>
          <td>
            <%= link_to cw_div_image_only(@item_side, :image => 'image_stock'), stock_minisite_item_side_path(@item_side, 1), :remote => true %>
          </td>
          <% @admin_customer_offer.portraits.each do |portrait| %>
              <td>
                <%= link_to cw_div_image_only(portrait), portrait_minisite_item_side_path(@item_side, portrait.id), :remote => true %>
              </td>
          <% end %>
        </tr>
      </table>
    </div>

    <!-- remove for now, think should go on different page
    <!-- upload a file for new portrait
    <div class="field">
       f.label :image_stock, 'Portrait:' %>
       f.file_field :image_stock %>
      <br/>
       f.label :remote_image_stock_url, 'or Portrait URL' %>
       f.text_field :remote_image_stock_url %>
    </div>
     f.hidden_field :image_stock_cache %>
    -->

    <div class="actions">
      <%= f.submit :id => 'my_submit' %>
      <span id="spinner" style="display:none"></span>
    </div>
<% end %>

<!-- Pass dimensions of piece template to javascript for portraits.js to pick up. -->
<%= javascript_tag do %>
    window.pieceWidth    = <%= @item_side.part.width %>
    window.pieceHeight   = <%= @item_side.part.height %>
    window.partLayoutWidth   = <%= @item_side.part.part_layout.layout.w %>
    window.partLayoutHeight  = <%= @item_side.part.part_layout.layout.h %>
    window.partLayoutOffsetX = <%= @item_side.part.part_layout.layout.x %>
    window.partLayoutOffsetY = <%= @item_side.part.part_layout.layout.y %>
<% end %>