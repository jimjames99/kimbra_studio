<div id='title_bar'>
<h3>Email Activity</h3>
 </div>
<div class='panel_contents'>

<table id='dashboard_emails'>
  <tr>
    <th>Session</th>
    <th>Client</th>
    <th class='right'>Offers</th>
    <th>sent</th>
    <th>read</th>
    <th>clicked through</th>
    <th class='right'>purchased</th>
  </tr>

  <% sessions.each do |session| %>

      <% session.emails.each do |email| %>
          <tr>
            <td><%= link_to session.name, my_studio_session_path(session) %></td>
            <td><%= session.try(:client).try(:name) %></td>
            <td style='text-align:right;'><%= email.try(:offers).try(:count) %></td>
            <td><%= email.sent_at ? "#{time_ago_in_words email.sent_at} ago" : 'not yet'  %></td>
            <td><%= email.opened_at ? "#{time_ago_in_words email.opened_at} ago" : 'not yet'  %></td>
            <td><%= email.visited_at ? "#{time_ago_in_words email.visited_at} ago" : 'not yet' %></td>
            <td style='text-align:right;'><%= email.offers.select{|o| o.purchased_at.present? }.count %></td>
          </tr>
      <% end %>

  <% end %>

</table>
</div>